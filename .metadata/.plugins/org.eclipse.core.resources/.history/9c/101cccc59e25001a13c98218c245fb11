package com.logiqube.basketqube.dataimport.service;

import java.util.Optional;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.logiqube.basketqube.dataimport.repository.PlayerRepository;
import com.logiqube.basketqube.dto.mapper.PlayerMapper;
import com.logiqube.basketqube.dto.model.PlayerDto;
import com.logiqube.basketqube.model.Player;

@Service
public class PlayerServiceImpl implements PlayerService {
	
	private static final Logger logger = LoggerFactory.getLogger(PlayerServiceImpl.class);

	@Autowired
	private PlayerRepository playerRepository;

	@Override
	public PlayerDto savePlayer(PlayerDto playerDto) {
		Player player = playerRepository.findByFirstNameAndLastName(playerDto.getFirstName(), playerDto.getLastName());
		if(player == null) {
			player = PlayerMapper.toPlayerEntity(playerDto);
			return PlayerMapper.toPlayerDto(playerRepository.save(player));
		}
		
//		throw new Exception();
		logger.error("Player duplicate");
		return null;
	}

	@Override
	public PlayerDto updatePlayer(PlayerDto playerDto) {
		Optional<Player> player = Optional.ofNullable(playerRepository.findByFirstNameAndLastName(playerDto.getFirstName(), playerDto.getLastName()));
		if(player.isPresent()) {
			Player playerModel = player.get();
			playerModel.setNationality(playerDto.getNationality());
			playerModel.setNote(playerDto.getNote());
			return PlayerMapper.toPlayerDto(playerRepository.save(playerModel));
		}
//		throw new Exception();
		//TODO handle exception
		logger.error("Player with this height doesn't exist");
		return null;
	}
	
	

}
